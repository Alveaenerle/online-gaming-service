<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Online Gaming Service - Pong 2P</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #game-container {
      text-align: center;
    }

    canvas {
      border: 2px solid #eee;
      background: #000;
      display: block;
      margin: 0 auto 10px auto;
    }

    #info {
      font-size: 14px;
      color: #bbb;
    }

    #score {
      font-size: 18px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
<div id="game-container">
  <div id="score">P1: 0 | P2: 0</div>
  <canvas id="game" width="640" height="360"></canvas>
  <div id="info">
    <b>Player 1:</b> W / S &nbsp;&nbsp;|&nbsp;&nbsp;
    <b>Player 2:</b> ↑ / ↓<br/>
    Piłka przyśpiesza po każdym odbiciu od paletki. Gdy ktoś nie trafi – punkt dla przeciwnika.
  </div>
</div>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const WIDTH = canvas.width;
  const HEIGHT = canvas.height;

  // Paletka - wspólna struktura
  function createPaddle(x) {
    return {
      x: x,
      y: HEIGHT / 2 - 40,
      width: 10,
      height: 80,
      speed: 6,
      dy: 0
    };
  }

  const leftPaddle = createPaddle(20);
  const rightPaddle = createPaddle(WIDTH - 30);

  const ball = {
    x: WIDTH / 2,
    y: HEIGHT / 2,
    radius: 7,
    speedX: 0,
    speedY: 0
  };

  const BASE_SPEED_X = 4;
  const BASE_SPEED_Y = 3;
  const SPEED_INCREASE_FACTOR = 1.06;   // przyśpieszenie po każdym odbiciu
  const MAX_SPEED = 14;

  let scoreP1 = 0;
  let scoreP2 = 0;

  const scoreEl = document.getElementById("score");

  function updateScoreText() {
    scoreEl.textContent = `P1: ${scoreP1} | P2: ${scoreP2}`;
  }

  function resetBall(directionToRight) {
    ball.x = WIDTH / 2;
    ball.y = HEIGHT / 2;

    const dirX = directionToRight ? 1 : -1;
    const dirY = Math.random() < 0.5 ? -1 : 1;

    ball.speedX = dirX * BASE_SPEED_X;
    ball.speedY = dirY * BASE_SPEED_Y;
  }

  function clampPaddle(paddle) {
    if (paddle.y < 0) {
      paddle.y = 0;
    }
    if (paddle.y + paddle.height > HEIGHT) {
      paddle.y = HEIGHT - paddle.height;
    }
  }

  function accelerateBallAfterHit() {
    ball.speedX *= -SPEED_INCREASE_FACTOR;
    ball.speedY *= SPEED_INCREASE_FACTOR;

    // ograniczenie maksymalnej prędkości
    if (Math.abs(ball.speedX) > MAX_SPEED) {
      ball.speedX = Math.sign(ball.speedX) * MAX_SPEED;
    }
    if (Math.abs(ball.speedY) > MAX_SPEED) {
      ball.speedY = Math.sign(ball.speedY) * MAX_SPEED;
    }
  }

  function update() {
    // Ruch paletek
    leftPaddle.y += leftPaddle.dy;
    rightPaddle.y += rightPaddle.dy;
    clampPaddle(leftPaddle);
    clampPaddle(rightPaddle);

    // Ruch piłki
    ball.x += ball.speedX;
    ball.y += ball.speedY;

    // Odbicie od góry/dół
    if (ball.y - ball.radius < 0 || ball.y + ball.radius > HEIGHT) {
      ball.speedY *= -1;
    }

    // Kolizja z lewą paletką (P1)
    const hitLeftHorizontally =
            ball.x - ball.radius <= leftPaddle.x + leftPaddle.width &&
            ball.x - ball.radius >= leftPaddle.x;

    const hitLeftVertically =
            ball.y + ball.radius >= leftPaddle.y &&
            ball.y - ball.radius <= leftPaddle.y + leftPaddle.height;

    if (hitLeftHorizontally && hitLeftVertically && ball.speedX < 0) {
      // losowa zmiana kierunku po odbiciu
      ball.speedY = (Math.random() * 4 - 2); // zakres od -2 do 2
      accelerateBallAfterHit();
    }

    // Kolizja z prawą paletką (P2)
    const hitRightHorizontally =
            ball.x + ball.radius >= rightPaddle.x &&
            ball.x + ball.radius <= rightPaddle.x + rightPaddle.width;

    const hitRightVertically =
            ball.y + ball.radius >= rightPaddle.y &&
            ball.y - ball.radius <= rightPaddle.y + rightPaddle.height;

    if (hitRightHorizontally && hitRightVertically && ball.speedX > 0) {
      const offset = (ball.y - (rightPaddle.y + rightPaddle.height / 2)) / (rightPaddle.height / 2);
      ball.speedY = offset * Math.abs(ball.speedY || BASE_SPEED_Y);
      accelerateBallAfterHit();
    }

    // Kto stracił punkt?
    if (ball.x + ball.radius < 0) {
      // piłka wyszła po lewej - punkt dla P2
      scoreP2++;
      updateScoreText();
      resetBall(true);   // serw w prawo (do P2)
    } else if (ball.x - ball.radius > WIDTH) {
      // piłka wyszła po prawej - punkt dla P1
      scoreP1++;
      updateScoreText();
      resetBall(false);  // serw w lewo (do P1)
    }
  }

  function drawNet() {
    ctx.setLineDash([5, 5]);
    ctx.strokeStyle = "#444";
    ctx.beginPath();
    ctx.moveTo(WIDTH / 2, 0);
    ctx.lineTo(WIDTH / 2, HEIGHT);
    ctx.stroke();
    ctx.setLineDash([]);
  }

  function draw() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);

    // tło
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, WIDTH, HEIGHT);

    drawNet();

    // paletki
    ctx.fillStyle = "#0f0";
    ctx.fillRect(leftPaddle.x, leftPaddle.y, leftPaddle.width, leftPaddle.height);

    ctx.fillStyle = "#0af";
    ctx.fillRect(rightPaddle.x, rightPaddle.y, rightPaddle.width, rightPaddle.height);

    // piłka
    ctx.fillStyle = "#f5f5f5";
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
    ctx.fill();
  }

  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  // Obsługa klawiszy
  window.addEventListener("keydown", (e) => {
    if (e.key === "w" || e.key === "W") {
      leftPaddle.dy = -leftPaddle.speed;
    } else if (e.key === "s" || e.key === "S") {
      leftPaddle.dy = leftPaddle.speed;
    }

    if (e.key === "ArrowUp") {
      rightPaddle.dy = -rightPaddle.speed;
    } else if (e.key === "ArrowDown") {
      rightPaddle.dy = rightPaddle.speed;
    }
  });

  window.addEventListener("keyup", (e) => {
    if (e.key === "w" || e.key === "W") {
      if (leftPaddle.dy < 0) leftPaddle.dy = 0;
    } else if (e.key === "s" || e.key === "S") {
      if (leftPaddle.dy > 0) leftPaddle.dy = 0;
    }

    if (e.key === "ArrowUp") {
      if (rightPaddle.dy < 0) rightPaddle.dy = 0;
    } else if (e.key === "ArrowDown") {
      if (rightPaddle.dy > 0) rightPaddle.dy = 0;
    }
  });

  // start gry
  resetBall(true);
  updateScoreText();
  gameLoop();
</script>
</body>
</html>
