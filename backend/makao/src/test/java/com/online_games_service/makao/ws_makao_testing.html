<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Makao WS Test</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #0b132b; color: #f5f7fb; }
    .box { border: 1px solid #3a506b; padding: 12px; margin-bottom: 12px; border-radius: 6px; background: #1c2541; }
    #logs { height: 320px; overflow-y: auto; background: #0f172a; border: 1px solid #3a506b; padding: 8px; }
    .log-entry { margin: 3px 0; border-bottom: 1px solid #243b55; padding-bottom: 3px; }
    label { display: block; margin-top: 8px; }
    input, button { margin-top: 6px; padding: 8px; border-radius: 4px; border: 1px solid #3a506b; background: #3a506b; color: #f5f7fb; }
    button { cursor: pointer; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
  </style>
</head>
<body>
  <h2>WebSocket Test â€“ Makao (/topic/makao/{playerId})</h2>

  <div class="box">
    <div>Status: <b id="status" style="color:red">DISCONNECTED</b></div>
    <label>Player ID (subscription target)</label>
    <input type="text" id="playerId" placeholder="user-uuid">
    <label>WS endpoint URL (SockJS)</label>
    <input type="text" id="wsUrl" value="http://localhost/api/makao/ws">
    <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
      <button onclick="connect()">Connect</button>
      <button onclick="disconnect()">Disconnect</button>
      <button onclick="clearLogs()">Clear</button>
    </div>
  </div>

  <h3>Messages:</h3>
  <div id="logs"></div>

<script>
  let stomp = null;

  function log(msg) {
    const logs = document.getElementById('logs');
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.innerText = `${new Date().toLocaleTimeString()}: ${msg}`;
    logs.appendChild(entry);
    logs.scrollTop = logs.scrollHeight;
  }

  function setStatus(connected) {
    const el = document.getElementById('status');
    el.innerText = connected ? 'CONNECTED' : 'DISCONNECTED';
    el.style.color = connected ? 'lime' : 'red';
  }

  function connect() {
    const playerId = document.getElementById('playerId').value.trim();
    const url = document.getElementById('wsUrl').value.trim();
    if (!playerId) {
      alert('Podaj playerId do subskrypcji /topic/makao/{playerId}');
      return;
    }

    log(`Connecting to ${url} ...`);
    const socket = new SockJS(url);
    stomp = Stomp.over(socket);
    stomp.debug = null;

    stomp.connect({}, () => {
      setStatus(true);
      const topic = `/topic/makao/${playerId}`;
      log('Connected. Subscribing to ' + topic);
      stomp.subscribe(topic, (msg) => {
        log('MESSAGE: ' + msg.body);
      });
    }, (err) => {
      setStatus(false);
      log('Connection error: ' + err);
    });
  }

  function disconnect() {
    if (stomp) {
      stomp.disconnect(() => {
        log('Disconnected');
        setStatus(false);
      });
    } else {
      setStatus(false);
    }
  }

  function clearLogs() {
    const logs = document.getElementById('logs');
    logs.innerHTML = '';
  }
</script>
</body>
</html>
